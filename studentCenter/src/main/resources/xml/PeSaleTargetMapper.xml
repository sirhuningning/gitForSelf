<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.koolearn.crm.system.mapper.PeSaleTargetMapper">
  <resultMap id="saleResultMap" type="com.koolearn.crm.system.model.PeSaleTarget">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 12 18:21:36 CST 2018.
    -->
    <id column="tid" property="tid" jdbcType="INTEGER"/>
    <result column="target_date" property="targetDate" jdbcType="INTEGER"/>
    <result column="sysid" property="sysid" jdbcType="INTEGER"/>
    <result column="target_value" property="targetValue" jdbcType="DOUBLE"/>
    <result column="deptid" property="deptid" jdbcType="INTEGER"/>
    <result column="deptcode" property="deptcode" jdbcType="VARCHAR"/>
  </resultMap>
  <insert id="insert" parameterType="com.koolearn.crm.system.model.PeSaleTarget">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 12 18:21:36 CST 2018.
    -->
    <selectKey resultType="java.lang.Integer" keyProperty="tid" order="AFTER">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into pe_sale_target (target_date, sysid, target_value, 
      deptid, deptcode)
    values (#{targetDate,jdbcType=INTEGER}, #{sysid,jdbcType=INTEGER}, #{targetValue,jdbcType=DOUBLE}, 
      #{deptid,jdbcType=INTEGER}, #{deptcode,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.koolearn.crm.system.model.PeSaleTarget">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 12 18:21:36 CST 2018.
    -->
    update pe_sale_target
    set target_date = #{targetDate,jdbcType=INTEGER},
      sysid = #{sysid,jdbcType=INTEGER},
      target_value = #{targetValue,jdbcType=DOUBLE},
      deptid = #{deptid,jdbcType=INTEGER},
      deptcode = #{deptcode,jdbcType=VARCHAR}
    where tid = #{tid,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" resultMap="saleResultMap" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 12 18:21:36 CST 2018.
    -->
    select tid, target_date, sysid, target_value, deptid, deptcode
    from pe_sale_target
    where tid = #{tid,jdbcType=INTEGER}
  </select>
  <select id="queryAllSaleTarget" resultType="java.util.Map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 12 18:21:36 CST 2018.
    -->
    select dept.deptname,sum(sale.target_value) as target_value,sale.target_date
    from pe_sale_target sale
    join pe_department dept on sale.deptid=dept.deptid
    <where>
      <if test="beginDate!=0 and endDate!=0">
        sale.target_date between #{beginDate} and #{endDate}
      </if>
    </where>
    group by target_date,target_date
    order by sale.target_date desc
  </select>
</mapper>